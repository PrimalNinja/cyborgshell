// CyborgShell v20250307 ===========================================================
// by PrimalNinja of Cyborg Unicorn Pty Ltd. Copyright 2025. All Rights Reserved.

/*jsl:ignore*/

function cyborgShell(Ua,Va,Wa,Xa){function Ya(a,c){setTimeout(a,c)}function ya(a){setTimeout(a,0)}function l(a,c,b,e){void 0===c&&(c=!1);void 0===b&&(b=!1);void 0===e&&(e=!1);X.push({rtl:Y&&!c,reverse:b,output:a,dontescape:e});var g="";F.html("");n(X,function(b){var a="";b.rtl&&(a="rtlo");var c=b.output;b.reverse&&b.rtl&&(c=Za(c));g=b.dontescape?g+('<div class="'+a+'">'+c+"</div>"):g+('<div class="'+a+'">'+za(c)+"</div>")});F.html(g);ka()}function C(a,c){var b=0,e=0,g=0,f="";n(a,function(a){if(a&&
"string"===typeof a.lc){0<f.length&&(f+="\r\n");var c="";e=Z(a.lc,!1);g=Z(a.lc,!0);b+=e;0<b&&(c="\t".repeat(b));var d="";a=a.lc.trim();0<a.length&&(d=c+a);f+=d;b+=g}});return f}function $a(a){a=a.charCodeAt(0).toString(16).toUpperCase();2>a.length&&(a="0"+a);return a}function la(){X=[];F.html("")}function aa(a){for(;t<=a;)d.push(u([],H,x,p,!1,"",0)),t++}function u(a,c,b,e,g,f,d){return{fn:c,mt:b,mte:e,raw:f,rs:d,cd:a,ln:null,pl:"",arg:"",fl:"",st:"",dt:g}}function ab(a,c,b,e){var g;a=a.replace(/\s+/g,
"-");var f={projectName:a,files:[]};g="";for(a=0;a<c.length;a++)g=c[a],f.files.push(u([],g,"","",!0,"",0));for(a=0;a<c.length;a++)g="output-"+c[a],g=u([],g,x,p,!0,"",0),g.ln=a+1,g.pl=b,g.arg=e,f.files.push(g);g=u([],b,x,p,!1,"",0);g.fn=b;g.mt="text/javascript transformer";g.mte="text";f.files.push(g);return f}function ma(a){document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"}function bb(a){var c=Aa(d[h].cd,a);if(0<=c){var b=a+" "+d[h].cd[c].lc.replace(/[ \r\n]+$/,"");d[h].dt=!0;ya(function(){ka();
q.val(b)})}else k("Line number out of range.")}function k(a){l(a,!1,!0)}function za(a){a=E(a,"&","&amp;");a=E(a,"<","&lt;");a=E(a,">","&gt;");a=E(a,'"',"&quot;");return a=E(a,"'","&#39;")}function na(a){for(var c=-1,b=0;b<N.length;b++)if(N[b].eventname===a){c=b;break}return c}function cb(a){var c=-1;for(intI=0;intI<d.length;intI++)if(d[intI].fn===a){c=intI;break}return c}function Aa(a,c){var b=-1,e=0;n(a,function(a){a.ln===c&&(b=e);e++});return b}function db(a,c,b,e){function g(a){console.log("start of internal callback");
a.cd?((a.mte===v||a.mte===p)&&a.mte!==b.mte?(b.mte=a.mte,b.mt=void 0!==a.mt&&null!==a.mt?a.mt:b.mte===v?O:ba):void 0!==a.mt&&(null!==a.mt&&a.mt!==b.mt)&&(b.mt=a.mt),b.cd=a.cd,b.raw=C(a.cd),b.rs=b.raw.length):a.raw?((a.mte===v||a.mte===p)&&a.mte!==b.mte?(b.mte=a.mte,b.mt=void 0!==a.mt&&null!==a.mt?a.mt:b.mte===v?O:ba):void 0!==a.mt&&(null!==a.mt&&a.mt!==b.mt)&&(b.mt=a.mt),b.raw=a.raw,b.rs=a.raw.length,b.cd=y(a.raw,a.mte)):(b.raw="",b.cd=[],b.rs=0);a.message&&0<a.message.length&&l(a.message,!1,!0);
a.error&&0<a.error.length&&k(a.error);console.log("set dirty flag");b.dt=!0;m_objThis.isFunction(e)&&(console.log("end of executePlugin about to callback"),e())}try{var f=C(d[a].cd,p),r=d[a].fn.replace(".xfrm","_xfrm");eval("system_api = {};");system_api.sfn=c.fn;system_api.smt=c.mt;system_api.smte=c.mte;system_api.tfn=b.fn;system_api.raw=c.mte===v?c.raw:C(c.cd);system_api.cd=c.cd;system_api.cb=g;system_api.arg=b.arg;a="(function(api, globals){"+f+"; "+r+"(api, globals, system_api.sfn, system_api.smt, system_api.smte, system_api.tfn, system_api.raw, system_api.cd, system_api.arg, system_api.cb); })(m_objAPI, m_objG);";
console.log("about to eval plugin which has an internal callback");eval(a)}catch(h){console.log("eval plugin exception, end of executePlugin about to callback"),k(h.message),a=C(c.cd),b.cd=y(a,c.mte),b.rs=a.length,m_objThis.isFunction(e)&&e()}}function P(a,c){var b=O,e=a.split(".").pop().toLowerCase(),g=!1;n(ca,function(a){if(a.mt===c||a.ext===c)return b=a.mt,g=!0});g||n(ca,function(a){if(a.ext===e)return b=a.mt,g=!0});return b}function I(a,c){var b=v,e=a.split(".").pop().toLowerCase(),g=!1;n(ca,
function(a){if(a.mt===c||a.ext===c)return b=a.mte,g=!0});g||n(ca,function(a){if(a.ext===e)return b=a.mte,g=!0});return b}function oa(a){var c=-1,b=-1;n(d,function(e,g,f){if(e.fn===a&&(e.dt?c=f:-1===b&&(b=f),0<=c))return!0});-1===c&&(c=b);return c}function Z(a,c){var b=0;if(d[h].mte===p){var e=a.trim();if("//"!==e.slice(0,2))if("{"===e.slice(-1)||"["===e.slice(-1)||"("===e)c&&(b=Ba);else if("}"===e||")"===e||"};"===e||"];"===e||"}];"===e||"});"===e||"]"===e.slice(-1)||"}]"===e.slice(-2)||"},"===e.slice(0,
2)||"],"===e.slice(0,2)||"}],"===e.slice(0,3))c||(b=-Ba)}return b}function w(a,c){var b=NaN,e,g;c=c||10;if(e=a.replace(/^\s+|\s+$/g,""))g=16===c?/^-?[0-9a-fA-F]+$/:/^-?\d+$/,g.test(e)&&(b=parseInt(e,c));return b}function Ca(a){a=a.split(" ");var c="",b=!0;n(a,function(a){b?b=!1:(0<c.length&&(c+=" "),c+=a)});return c}function s(a,c,b,e,g,f,r,M){var G="",p="",da="",ea="",q="",t="",u="",w=e;void 0===w&&(w=!1);var v=r;void 0===v&&(v=!1);var s=M;void 0===s&&(s=!1);var x=g;void 0===x&&(x=!1);var z=f;void 0===
z&&(z=!1);e=a.split(" ");var A=0;1===c?(G=e[1]||"",da=e[2]||"",ea=e[3]||"",q=e[4]||"",A=5):2===c?(G=e[1]||"",p=e[2]||"",da=e[3]||"",ea=e[4]||"",q=e[5]||"",A=6):0===c&&(da=e[1]||"",ea=e[2]||"",q=e[3]||"",A=4);var B=0;n(e,function(a){B>=A&&(0<t.length&&(t+=" "),t+=a);B++});s&&(u=C(d[h].cd,!0),d[h].fn=G);$.post("",{commandline:a,f1:G,f2:p,p1:da,p2:ea,p3:q,r:t,content:u},function(c){c=JSON.parse(c);c.actions.includes("invalidate")&&ma(T);c.actions.includes("ltr")&&pa(!1);c.actions.includes("rtl")&&qa(!1);
!z&&0<c.error.length&&k(c.error);!x&&0<c.message.length&&(a.startsWith("help")?l(c.message,!1,!1,!0):a.startsWith("cat")||a.startsWith("dir")||a.startsWith("ls")?(l(c.message,!1),l(c.content,!1)):l(c.message,!1));v&&(u=c.content,d[h].fn=G,d[h].mt=P(G,""),d[h].mte=I(G,""),d[h].raw=u,d[h].rs=u.length,d[h].cd=y(u,d[h].mte),d[h].dt=!1,U(h));s&&0===c.error.length&&(d[h].dt=!1);m_objThis.isFunction(b)&&b(c);m("handleServerCommands",w)})}function eb(a){a=a.trim().split(" ");for(var c="",b=0;b<a.length;b++)var e=
w(a[b],16),e=String.fromCharCode(e),c=-1!==fb.indexOf(e)?c+e:c+".";return za(c)}function gb(a,c,b,e){var g=b,f=e;g||(g="null.xfrm");g.endsWith(".xfrm")||(g+=".xfrm");void 0===f&&(f="");0>c||0>a?(k("Invalid file number."),m("linkFile")):c===a?(k("A file cannot be linked to itself."),m("linkFile")):c>=t||a>=t?Da():-1===oa(g)?(console.log("about to load plugin"),Q(g,function(b){console.log("plugin loaded");if(0===b.error.length){var e=b.content;b=t;d.push(u([],g,ra,p,!1,e,e.length));e=y(e,p);d[b].cd=
e;t++;d[a].ln=c;d[a].pl=g;d[a].arg=f;console.log("before updating linked file");V(d[c],d[a],function(){console.log("before updating linked file ready");m("linkFile")})}else k("Failed to load plugin: "+b.error),m("linkFile");console.log("plugin loaded end")})):(console.log("plugin already loaded"),d[a].ln=c,d[a].pl=g,d[a].arg=f,V(d[c],d[a],function(){m("linkFile")}))}function Q(a,c){$.post("",{commandline:"load",f1:a,f2:"",p1:"",p2:"",p3:"",r:"",content:""},function(a){a=JSON.parse(a);a.actions.includes("invalidate")&&
ma(T);m_objThis.isFunction(c)&&c(a)})}function Ea(a,c){Q(a,function(a){a.actions.includes("ltr")&&pa(!1);a.actions.includes("rtl")&&qa(!1);0<a.error.length&&k(a.error);0<a.message.length&&l(a.message,!1);m_objThis.isFunction(c)&&c(a)})}function Fa(a){var c=!1;try{localStorage.removeItem(R+a),c=!0}catch(b){c=!1}return c}function sa(a){var c=null;try{var b=localStorage.getItem(R+a);null!==b&&(c=JSON.parse(b))}catch(e){c=null}return c}function Ga(a,c){var b=!1;try{var e=R+a,g=JSON.stringify(c);localStorage.setItem(e,
g);b=!0}catch(f){b=!1}return b}function fa(a,c,b){null!==c?(c>t?aa(c):(d.push(u([],H,a,p,!1,"",0)),h=t,t++),h=c):(d.push(u([],H,a,p,!1,"",0)),h=t,t++);m("cmdNewFile",b)}function hb(a){var c={};if(a){var b=a.indexOf("-");-1!==b&&b!==a.length-1?(a=a.split("-"),c.from=w(a[0],10),c.to=w(a[1],10)):"-"===a.charAt(0)?(c.from=-Infinity,c.to=w(a.substring(1),10)):"-"===a.charAt(a.length-1)?(c.from=w(a.substring(0,a.length-1),10),c.to=Infinity):(c.from=w(a,10),c.to=w(a,10))}else c.from=-Infinity,c.to=Infinity;
return c}function Ha(a){Ia=a;q.val("");Ia?q.attr("type","password"):q.attr("type","email")}function n(a,c){if(null!==a)for(var b=1,e=0,g=!1;!g&&e<a.length;)void 0!==a[e]&&m_objThis.isFunction(c)&&(g=c(a[e],b,e)),b++,e++}function m(a,c){var b=c;void 0===b&&(b=!1);b||(ib?l("Ready:"+a,!1,!0):l("Ready",!1,!0))}function Za(a){var c=a.split("\n"),b=0,e="";n(c,function(a){e=a;a=e.split("").reverse();for(var f=a.length,d=0;d<f;d++)switch(a[d]){case "(":a[d]=")";break;case ")":a[d]="(";break;case "[":a[d]=
"]";break;case "]":a[d]="[";break;case "{":a[d]="}";break;case "}":a[d]="{"}e=a.join("");c[b]=e;b++});return a=e=c.join("\n")}function ta(a,c){try{m_objAPI.commandline=c,eval("(function(api, globals){"+a+"})(m_objAPI, m_objG);")}catch(b){k(b.message)}}function ua(a,c,b){$.post("",{commandline:"save",f1:a,f2:"",p1:"",p2:"",p3:"",r:"",content:c},function(a){a=JSON.parse(a);a.actions.includes("invalidate")&&ma(T);m_objThis.isFunction(b)&&b(a)})}function ka(){Ya(function(){var a=document.querySelector("#ge-clicontainer");
a.scrollTop=a.scrollHeight-a.clientHeight},100)}function E(a,c,b){var e=!1;c+="";b+="";a+="";void 0===c&&(c="");void 0===b&&(b="");void 0===a&&(a="");0<=b.indexOf(c)&&(b=E(b,c,"__OLD__"),e=!0);for(;0<=a.indexOf(c);)a=a.replace(c,b);e&&(a=E(a,"__OLD__",c));return a}function y(a,c){var b=[],e=1,g=10;if(c===v)for(var d="",h=0,M=0;M<a.length;M++){var l=a[M];h===va||M===a.length-1?(h=eb(d),d.length<3*va&&(d+=Array(3*va-d.length+1).join(" ")),d+="  "+h,b.push({ln:g,lc:d}),g+=10,e++,h=0,d=""):(d+=$a(l)+
" ",h++)}else if(c===p){var k=a.split("\n");n(k,function(a){a=a.trim();e===k.length&&0===a.length||(b.push({ln:g,lc:a}),g+=10,e++)})}return b}function Ja(a){var c=C(d[a].cd,!1);d[a].rs=c.length}function V(a,c,b){if(a.dt){var e=oa(c.pl||"blocker.xfrm");-1!==e?db(e,a,c,b):(e=C(a.cd),c.cd=y(e,a.mte),c.rs=e.length,m_objThis.isFunction(b)&&b())}else m_objThis.isFunction(b)&&b()}function Ka(a){function c(a){if(-1===e.indexOf(a)){e.push(a);var b=[];for(f=0;f<d.length;f++)d[f].ln===a&&(g.push({source:a,target:f}),
b.push(f));for(a=0;a<b.length;a++)c(b[a])}}function b(){if(h<g.length){var a=g[h];h++;V(d[a.source],d[a.target],b)}}var e=[],g=[],f;c(a);var h=0;b()}function La(a){function c(a,g){if(-1!==b.indexOf(a))m_objThis.isFunction(g)&&g();else{b.push(a);var f=[];n(d,function(b,c,d){b.ln===a&&f.push({file:b,index:d})});var h=0;0===f.length?m_objThis.isFunction(g)&&g():n(f,function(b){V(d[a],b.file,function(){h++;if(h===f.length){var a=0;n(f,function(b){c(b.index,function(){a++;a===f.length&&m_objThis.isFunction(g)&&
g()})})}})})}}var b=[];c(a)}function U(a){if(void 0===a)for(a=0;a<d.length;a++)d[a].dt&&(Ma?La(a):Ka(a));else Ma?La(a):Ka(a)}function jb(a){var c=a.originalEvent,b="";if(0===J&&!K&&((c=c.clipboardData||window.clipboardData)&&c.getData&&(b=c.getData("text")||c.getData("text")),-1!==b.indexOf("\n"))){a.preventDefault();b=E(b,"\t"," ");b=E(b,"\r","");a=b.split("\n");var e=!1,g=0,f="";if(0<a.length&&(f=a[0],a=f.split(" "),g=w(a[0],10),isNaN(g)||0===g))e=!0;var r=d[h].cd,g=0;0<r.length&&(g=r[r.length-
1].ln);g+=10;e?l("autonumber",!1,!0):l("preserve line numbers",!1,!0);a=b.split("\n");n(a,function(a){f=a.trim();l(f,!1,!0);e?r.push({ln:g,lc:f}):W(f,null,!0);g+=10});b=C(r,!0);d[h].rs=b.length;d[h].cd=y(b,d[h].mte);q.val("");m("inputCommand_onPaste")}}function kb(a,c,b){var e="",g=Aa(d[h].cd,a);0<=g?(a=c.split(" "),1<a.length?(e=Ca(c),0<e.trim().length&&(d[h].cd[g].lc=e,d[h].dt=!0)):(d[h].cd.splice(g,1),d[h].dt=!0)):(e=Ca(c),d[h].cd.push({ln:a,lc:e}),d[h].dt=!0,d[h].cd.sort(function(a,b){return a.ln-
b.ln}));Ja(h);U(h);m("cmdAddReplaceDeleteLine",b)}function Da(){0<D.length&&l("Project name: "+D,!1,!0);0<ga.length&&l("Project filename: "+ga,!1,!0);var a=0;l("Files:",!1,!0);n(d,function(c){var b=a.toString().padStart(lb," "),e=" ";h===a&&(e="*");var d=" ";c.dt&&(d="D");var f="";if(c.fn.endsWith(".xfrm")||c.mt===ra)f=" [PLUGIN]";var r=c.fl;0<r.length&&(r=" "+r);var k=c.ln,m="";null!==k&&0<=k&&(m=" Linked to "+k+":"+c.pl+":"+c.arg);k=c.st;0<k.length&&(k=" "+k);l(b+" "+e+d+" "+c.fn+f+" "+c.rs+" bytes/"+
c.cd.length+" lines ("+c.mt+":"+c.mte+")"+r+m+k,!1,!0);a++});l("\n* current file, D dirty file",!1,!0);m("cmdFiles")}function Na(a,c){var b=0,e=0,d=0;if(0<a.length){var f=hb(c);a.length>mb&&-Infinity===f.from&&Infinity===f.to?k("Too many lines, list a range."):n(a,function(a){var c=!0,h=a.ln;-Infinity!==f.from&&h<f.from&&(c=!1);Infinity!==f.to&&h>f.to&&(c=!1);if(c){c="";e=Z(a.lc,!1);d=Z(a.lc,!0);b+=e;0<b&&(c="\t".repeat(b));var h=h.toString().padStart(nb," "),k="";a=a.lc.trim();k=0<a.length?h+"\t"+
c+a:h+"\t";l(k,!0);b+=d}})}m("cmdList")}function Oa(a){var c=!0,b=wa,e="";K?(K=!1,wa="",0===a.length?(c=!0,k("Missing parameters.")):(e=a[0].trim(),c=!1,s("login "+b+" "+e,0,Pa,!0))):1===a.length?(c=!0,k("Missing parameters.")):2===a.length?(b=a[1].trim(),c=!1,K=!0,wa=b,Ha(!0)):2<a.length&&(b=a[1].trim(),e=a[2].trim(),c=!1,s("login "+b+" "+e,0,Pa,!0));c&&m("cmdLogin")}function pa(a){Y=!1;q.removeClass("rtli");a&&m("cmdLTR")}function ob(a){if(2<a.length){var c=w(a[1].trim(),10);a=w(a[2].trim(),10);
if(0<c&&0<a&&a<=t){var b="",e="",g="",f="",r="",l="";n(d[h].cd,function(a){a.ln<c?(0<b.length&&(b+="\r\n"),r="",l=a.lc.trim(),0<l.length&&(r=l),b+=r):(0<e.length&&(e+="\r\n"),r="",l=a.lc.trim(),0<l.length&&(r=l),e+=r)});n(d[a].cd,function(a){0<g.length&&(g+="\r\n");r="";l=a.lc.trim();0<l.length&&(r=l);g+=r});f=b;0<f.length&&(f+="\r\n");f+=g;0<f.length&&(f+="\r\n");d[h].cd=y(f+e,d[h].mte);d[h].dt=!0;U(h)}else k("Invalid parameters.")}else k("Missing parameters.");m("cmdPaste")}function pb(a){if(2<
a.length){var c=a[2].trim();c.endsWith(".prj")||(c+=".prj");Q(c,function(a){if(0===a.error.length)try{var e=a.content,g=JSON.parse(e);d=[u([],"Run Space",x,p,!1,"",0)];D=g.projectName||"";ga=c;t=g.files.length+1||1;h=1;if(!g.files||0===g.files.length)q();else{var f=[];for(a=0;a<g.files.length;a++)f.push({fileInfo:g.files[a],idx:a+1});var r=function(){if(0===f.length)q();else{var a=f.shift(),b=a.fileInfo,c=a.idx;"Unnamed File"===b.fn?(d[c]=u([],b.fn,b.mt,b.mte,!1,"",0),d[c].ln=b.ln,d[c].pl=b.pl,d[c].arg=
b.arg,d[c].fl=b.fl,d[c].st=b.st,r()):Q(b.fn,function(a){0===a.error.length?(e=a.content,d[c]=u([],b.fn,b.mt,b.mte,!1,e,e.length),a=y(e,b.mte),d[c].cd=a,d[c].ln=b.ln,d[c].pl=b.pl,d[c].arg=b.arg,d[c].fl=b.fl,d[c].st=b.st,l("File loaded: "+b.fn,!1,!0)):(k("Could not load "+b.fn),d[c]=u([],b.fn,b.mt,b.mte,!1,"",0),d[c].ln=b.ln,d[c].pl=b.pl,d[c].arg=b.arg,d[c].fl=b.fl,d[c].st=b.st);r()})}};r();var q=function(){for(var a=0;a<t;a++){var b=d[a].ln;null!==b&&0<=b&&b<d.length&&d[b]&&0<d[b].cd.length&&V(d[b],
d[a],function(){})}l("Project loaded: "+D,!1,!0);m("cmdProjectLoad")}}}catch(n){k("Error parsing project file: "+n.message),m("cmdProjectLoad")}else k("Error loading project: "+a.error),m("cmdProjectLoad")})}else k("Missing filename."),m("cmdProjectLoad")}function qb(a){if(2<a.length){var c=a[2].trim();c.endsWith(".prj")||(c+=".prj");var b={projectName:D,files:[]},e=!0;n(d,function(a){e?e=!1:b.files.push({fn:a.fn,mt:a.mt,mte:a.mte,ln:a.ln,pl:a.pl,arg:a.arg,fl:a.fl,st:a.st})});a=JSON.stringify(b,null,
2);ua(c,a,function(a){0===a.error.length?(ga=c,l("Project saved to: "+c,!1,!0)):k("Error saving project: "+a.error);m("cmdProjectSave")})}else k("Missing filename."),m("cmdProjectSave")}function Qa(a){A=[];B=-1;t=2;h=1;d=[u([],"Run Space",x,p,!1,"",0),u([],H,x,p,!1,"",0)];X=[];eval("m_objG = {};");Y=!1;eval("m_objG.console = m_objThis;");q.val("");la();ha?l("Local storage is available.",!1,!0):l("Local storage is UNAVAILABLE.",!1,!0);Ra(a)}function qa(a){Y=!0;q.addClass("rtli");a&&m("cmdRTL")}function Sa(a){var c=
!0,b="";if(1<a.length)if(z)k("Invalid operation for the local space.");else{var e=a[1].trim();0<e.length&&(c=!1,Ea(e,function(c){c=c.content;0<c.length&&(d[0].fn=e,d[0].mt=P(e,""),d[0].mte=I(e,""),d[0].raw=c,d[0].rs=c.length,d[0].cd=y(c,d[0].mte),d[0].dt=!1,b=C(d[0].cd,!1),ta(b,a))}))}c&&(b=C(d[h].cd,!1),ta(b))}function rb(){function a(){if(0<b.length){var c=b.pop(),g=C(d[c].cd,!0);ua(d[c].fn,g,function(){d[c].dt=!1;a()})}else m("cmdSaveAll")}if(z)k("Invalid operation for the local space.");else{var c=
0,b=[];n(d,function(a){a.dt&&a.fn!==H&&b.push(c);c++});a()}}function sb(a){if(z)k("Invalid operation for the local space.");else{var c=!0;if(1<a.length){var b=a[1].trim(),e=a[2];0<b.length&&Ea(b,function(a){c=!1;a=y(a.content,p);Na(a,e)})}c&&m("cmdType")}}function Ra(a){for(var c=T+"=",b=document.cookie.split(";"),e="",d=0;d<b.length;d++){for(var f=b[d];" "===f.charAt(0);)f=f.substring(1);if(0===f.indexOf(c)){e=f.substring(c.length);break}}W("validatecookie "+e,null,a)}function Pa(a){var c=T;a=a.devicekey;
var b=tb,e="";b&&(e=new Date,e.setTime(e.getTime()+864E5*b),e="; expires="+e.toUTCString());document.cookie=c+"="+(a||"")+e+"; path=/";Ra(!1)}function ub(a){a=a.message;ha&&(a=E(a,"home","home\nlocal"));l(a,!1)}function vb(a){0<a.content.length&&l(a.content,!0)}function wb(a){Ta&&(Ta=!1,W("startup"),null!==ia&&0<ia.length&&W(ia))}function W(a,c,b){if("!"===a[0]){c=a.slice(1);var e=sa(L+"ai-handler");null!==e&&0<e.length&&(a="run "+e+".js "+c)}c=b;b=a.split(" ");var e=b[0],g=w(e,10);void 0===c&&(c=
!1);if(0===e.trim().length)l("");else if(isNaN(g))switch(e){case "beautify":if(1===b.length){b=C(d[h].cd,!1);try{var f=JSON.parse(b);b=JSON.stringify(f,null,2);d[h].cd=y(b,d[h].mte);d[h].dt=!0}catch(r){k(r.message)}m("cmdBeautify")}else s("run "+a,1);break;case "clear":case "cls":la();m("cmdCLS");break;case "config":f=!1;3>b.length?k("Missing parameters."):(a=b[1].trim().toLowerCase(),f=b[2].trim().toLowerCase(),"delete"===a?(f=Fa(L+f))?l("Config option deleted.",!1,!0):k("Failed to delete config option."):
"save"===a?4>b.length?k("Missing config option value."):(b=b.slice(3).join(" "),(f=Ga(L+f,b))?l("Config option saved.",!1,!0):k("Failed to save config option.")):k("Invalid action. Use save or delete."));m("cmdConfig");break;case "ed":case "edit":b=w(b[1],10);!isNaN(b)&&0<b?bb(b):(k("Invalid line number."),m("cmdEdit"));break;case "file":1<b.length?(b=w(b[1].trim(),10),0>b?k("Invalid file number."):(b>=t?aa(b):0>b&&(b=0),h=b)):l(d[h].fn);m("cmdFile");break;case "filename":1<b.length?(b=b[1].trim(),
0<b.length&&(d[h].fn=b)):l(d[h].fn);m("cmdFilename");break;case "files":Da();break;case "flavor":case "flavour":1<b.length?d[h].fl=b[1].trim():(l(d[h].fl,!1,!0),m("cmdFlavour"));break;case "link":2>b.length?(k("Missing parameters."),m("cmdLink")):(f=b[1],/^\d+$/.test(f)?3>b.length?(k("Missing parameters."),m("cmdLink")):(f=w(f,10),a=w(b[2],10),c=b[3],b=b.slice(4).join(" "),aa(f),aa(a),gb(f,a,c,b)):(2===b.length?(intExistingIndex=na(f),0<=intExistingIndex?(N.splice(intExistingIndex,1),l("Event link removed: "+
f,!1,!0)):l("No event link found for: "+f,!1,!0)):(a=b[2],b=b.slice(3).join(" "),a.endsWith(".xfrm")||(a+=".xfrm"),intExistingIndex=na(f),0<=intExistingIndex?(N.splice(intExistingIndex,1),l("Event link replaced: "+f+" => "+a+":"+b,!1,!0)):l("Event link added: "+f+" => "+a+":"+b,!1,!0),N.push({eventname:f,transformer:a,arg:b})),m("cmdLink")));break;case "list":Na(d[h].cd,b[1]);break;case "ltr":pa(!0);break;case "mimetype":1<b.length?(f=b[1].trim(),0<f.length&&(a=d[h].mte,b=I("",f),a===b?d[h].mt=P("",
f):(f=C(d[h].cd),d[h].mte=b,d[h].cd=y(f,d[h].mte)))):l(d[h].mt);m("cmdMimeType");break;case "new":d[h].fn=H;d[h].mt=P("",x);d[h].mte=I("",x);d[h].raw="";d[h].rs=0;d[h].cd=[];d[h].st="";d[h].dt=!1;m("cmdNew");break;case "newfile":f=x;a=null;1<b.length&&(b=w(b[1].trim(),10),!isNaN(b)&&0<b&&(a=b));fa(f,a,!1);break;case "paste":ob(b);break;case "project":1<b.length?(f=b[1].trim().toLowerCase(),"save"===f?z?k("Invalid operation for the local space."):qb(b):"load"===f?z?k("Invalid operation for the local space."):
pb(b):(D=b[1].trim(),l("Project name set to: "+D,!1,!0),m("cmdProject"))):(0<D.length?l("Current project: "+D,!1,!0):l("No project name set.",!1,!0),m("cmdProject"));break;case "renum":d[h].cd=y(C(d[h].cd,!1),d[h].mte);m("cmdRenum");break;case "reset":Qa(!1);break;case "rtl":qa(!0);break;case "run":Sa(b,b);break;case "touch":1<b.length?(b=w(b[1].trim(),10),0>b?k("Invalid file number."):b>t?k("File does not exist."):(Ja(b),U(b))):k("Missing file number.");m("cmdTouch");break;case "type":sb(b);break;
case "width":f=$("<span>").css({"font-family":F.css("font-family"),"font-size":F.css("font-size"),visibility:"hidden"}).text("W");F.append(f);b=f.width();f.remove();f=F.width();l(Math.floor(f/b),!1,!0);break;case "notes":case "startup":z?k("Invalid operation for the local space."):s(a,1,vb);break;case "login":Oa(b);break;case "validatecookie":s(a,0,wb,c);break;case "spaces":s(a,0,ub,!1,!0);break;case "cat":case "dir":case "ls":f=a;if(z){f=[];1<b.length&&b[1];for(b=0;b<localStorage.length;b++)a=localStorage.key(b),
"string"===typeof a&&(0<a.length&&a.startsWith(R))&&(a=a.substring(R.length),f.push(a));0===f.length?k("No files found."):(f.sort(),b=f.join(", "),l(b,!1,!0));m("cmdDir")}else s(f,0);break;case "device":case "devices":case "language":case "languages":case "about":case "admins":case "alias":case "chpwd":case "password":case "logout":case "offline":case "online":case "register":case "username":case "users":case "grant":case "keys":case "newkey":case "revoke":case "shares":s(a,0);break;case "cd":case "chdir":case "cs":case "space":f=
a;1<b.length&&"local"===b[1].trim().toLowerCase()?(ha?(z=!0,l("Space is now local.",!1,!0)):k("Local storage unavailable."),m("cmdSpace")):1<b.length?(z=!1,s(f,1)):z?(l("local",!1,!0),m("cmdSpace")):s(f,1);break;case "del":case "delete":case "era":z?k("Invalid operation for the local space."):s(a,1);break;case "help":s(a,1);break;case "load":z?k("Invalid operation for the local space."):s(a,1,null,!1,!1,!1,!0);break;case "saveall":rb();break;case "save":z?k("Invalid operation for the local space."):
s(a,1,null,!1,!1,!1,!1,!0);break;case "copy":case "cp":case "mv":case "ren":case "rename":z?k("Invalid operation for the local space."):s(a,2);break;default:b=a,f=b.split(" "),-1!==f[0].indexOf("(")||-1!==f[0].indexOf(")")?ta(b):(f[0].endsWith(".js")||(f[0]+=".js"),f.unshift("run"),Sa(f,f))}else kb(g,a,c)}var ib=!1,Ma=!0,T="csdevicekey",tb=365,lb=3,Ba=1,nb=7,L="config-",R="cyborgshell-",va=48,mb=1E3,H="Unnamed File",fb="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",
O="application/octet-stream",x="text/javascript",ra="text/javascript transformer",ba="text/plain",v="hex",p="text",ca=[{mt:O,ext:"binary",mte:v},{mt:O,ext:"exe",mte:v},{mt:O,ext:"octet-stream",mte:v},{mt:"application/json",ext:"json",mte:p},{mt:"application/pdf",ext:"pdf",mte:v},{mt:"application/zip",ext:"zip",mte:v},{mt:"image/bmp",ext:"bmp",mte:v},{mt:"image/gif",ext:"gif",mte:v},{mt:"image/jpeg",ext:"jpg",mte:v},{mt:"image/png",ext:"png",mte:v},{mt:"text/bat",ext:"bat",mte:p},{mt:"text/css",ext:"css",
mte:p},{mt:"text/csv",ext:"csv",mte:p},{mt:ba,ext:"hex",mte:p},{mt:"text/html",ext:"htm",mte:p},{mt:"text/html",ext:"html",mte:p},{mt:x,ext:"js",mte:p},{mt:"application/json",ext:"prj",mte:p},{mt:ra,ext:"xfrm",mte:p},{mt:ba,ext:"txt",mte:p}];eval("var m_objThis = this;");var S=$(Ua),q=$(Va),F=$(Wa),K=!1,Ia=!1,J=0,wa="",ja=null,xa="",Ta=Xa,t=2,h=1,D="",ga="",ha=function(){var a=!1;try{var c=R+"test";localStorage.setItem(c,c);localStorage.removeItem(c);a=!0}catch(b){a=!1}return a}(),z=!1,ia="";ha&&
(ia=sa(L+"autorun"));var d=[u([],"Run Space",x,p,!1,"",0),u([],H,x,p,!1,"",0)],X=[],A=[],B=-1,N=[];eval("var m_objG = {};");var Y=!1;eval("m_objG.console = m_objThis;");eval("var m_objAPI = new cyborgShell_API(m_objG);");this.appendOutput=function(a,c,b){l(a,c,b)};this.clearOutput=function(){la()};this.deleteLocalData=function(a,c){var b=Fa(L+a);c(b)};this.end=function(){m("end",!1)};this.errorOutput=function(a){k(a)};this.fileStatus=function(a,c,b){var e=!1;if(""===a&&b){a=!1;for(b=0;b<d.length;b++)if(d[b].st===
c){a=!0;break}a||(d[h].st=c,e=!0)}else d[h].st===a&&(d[h].st=c,e=!0);return e};this.getCurrentFile=function(){return d[h]};this.handleServerCommands=function(a,c,b){s(a,c,b,!0,!0,!0)};this.injectFile=function(a,c){fa(a,null,!1);d[h].raw=c;d[h].rs=c.length;d[h].cd=y(c,d[h].mte);d[h].dt=!1};this.input=function(a,c){ja=c;J++;xa=a;q.focus();ya(function(){q.val(xa)})};this.isFunction=function(a){var c={};return a&&"[object Function]"===c.toString.call(a)};this.loadFile=function(a,c){Q(a,c)};this.loadLocalData=
function(a,c){var b=sa(L+a);c(b)};this.saveLocalData=function(a,c,b){a=Ga(L+a,c);b(a)};this.newFile=function(a){fa(a,null,!1)};this.saveFile=function(a,c,b){ua(a,c,b)};this.stop=function(){m("stop",!1)};this.onResize=function(){ka()};this.reset=function(){function a(a){var e,d=0;for(e=0;e<a.length;e++)(function(e){var h=a[e],l=new FileReader;l.onload=function(h){a[e].content=h.target.result;d++;d===a.length&&c(a)};l.onerror=function(l){a[e].content=null;d++;d===a.length&&c(a);k("Failed to read file: "+
h.name)};I(h.name,h.type)===p?l.readAsText(h):l.readAsBinaryString(h)})(e)}function c(a){var c=[],g,f,k,m="",q="",n="";for(g=0;g<a.length;g++)c.push(a[g].name);g=na("drop");if(0<=g){D="DroppedProject";g=N[g];var w=g.transformer,s=ab(D,c,w,g.arg);d=[u([],"Run Space",x,p,!1,"",0)];h=t=1;for(g=0;g<s.files.length;g++)strFilename=s.files[g].fn,n=c.indexOf(strFilename),k="",f=0,0<=n?(k=a[n].content,f=a[n].size,q=P(m,a[n].type),n=I(m,a[n].type),f=u([],strFilename,q,n,!0,k,f),f.cd=y(k,n)):(f=u([],strFilename,
s.files[g].mt,s.files[g].mte,!1,k,f),f.ln=s.files[g].ln,f.pl=s.files[g].pl,f.arg=s.files[g].arg,f.cd=y(k,p),f.dt=!0),d.push(f),t++;var v=oa(w);-1!==v&&Q(w,function(a){0===a.error.length&&(k=a.content,d[v].raw=k,d[v].rs=k.length,d[v].cd=y(k,p),U())});l("Project created from dropped files with event 'drop'.",!1,!0)}else{for(g=0;g<a.length;g++)m=a[g].name,q=P(m,a[g].type),n=I(m,a[g].type),k=a[g].content,f=a[g].size,c=cb(m),-1===c&&(c=d.length,fa(x,null,!0)),d[c].fn=m,d[c].mt=q,d[c].mte=n,d[c].raw=k,
d[c].rs=f,d[c].cd=y(k,n),d[c].dt=!0;l("Files loaded (no event detected).",!1,!0)}}Qa(!0);$(document.body).on("click",function(){q.focus()});q.on("paste",function(a){jb(a)});q.on("keydown",function(a){var c="";if(13===a.which)if(0<J)c=q.val(),m_objThis.isFunction(ja)&&ja(c),q.val(""),J--,0===J&&(ja=null,xa="");else if(K)c=q.val(),Ha(!1),a=c.split(" "),Oa(a);else{c=q.val();if(0<c.trim().length&&(0===A.length||A[A.length-1]!==c))A.push(c),50<A.length&&A.shift();B=-1;l(c,!1,!0);W(c);q.val("")}else 38===
a.which?0===J&&(!K&&0<A.length)&&(-1===B?B=A.length-1:0<B&&B--,q.val(A[B]),a.preventDefault()):40===a.which&&(0===J&&!K)&&(-1!==B&&(B++,B>=A.length?(B=-1,q.val("")):q.val(A[B])),a.preventDefault())});S.on("dragleave",function(){S.removeClass("dragover-highlight")});S.on("dragover",function(a){a.preventDefault();S.addClass("dragover-highlight")});S.on("drop",function(b){S.removeClass("dragover-highlight");b.preventDefault();a(b.originalEvent.dataTransfer.files)})}};
